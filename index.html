<!DOCTYPE html>
<head>
    <title>README compiler</title>
    <script src="//its-just-nans.github.io/js/useful.js"></script>
    <script src="//unpkg.com/showdown/dist/showdown.min.js"></script>
    <script src="//unpkg.com/@highlightjs/cdn-assets@10.4.1/highlight.min.js"></script>
    <link href="//its-just-nans.github.io/styleREADME.css" rel="stylesheet">
    <link href="//unpkg.com/@highlightjs/cdn-assets@10.4.1/styles/default.min.css" rel="stylesheet">
    <link href="https://its-just-nans.github.io/rt/style.css" rel="stylesheet">
</head>
<body>
    <div id="globalReadMe"></div>
    <input type="file" id="file">
<script>

let params = (new URL(document.location)).searchParams;
let checkCss = params.get('css');
if(checkCss){
    let link = document.createElement('link');
    link.href = checkCss;
    link.rel = "stylesheet";
    document.head.append(link);
}
let checkUrl = params.get('url');
if(checkUrl){
    document.getElementById('file').remove();
    loadNewPage(checkUrl);
}else{
    let text = `
# How to use :

### Parameters :

You can add parameters with \`https://its-just-nans.github.io/read-compiler?name1=value1&name2=value2\`

- put \`?url=\` to compile a file from an url

- put \`?css=\` to compile a css file from an url

### or upload and compile your file now
`;
    render(text);
    document.getElementById('file').onchange = function(){
        let selectedFile = this.files[0];
        let reader = new FileReader();
        reader.onload = function(){
            document.getElementById('file').remove();
            render(reader.result);
        };
        reader.readAsText(selectedFile);
    };
}

function loadNewPage(url){
    makeRequest('GET', url).then( function(response){
        render(response);
    }).catch(function (error){
        document.getElementById('globalReadMe').innerHTML = error.status;
        console.log('README compiler error: ', error);
    });
}

function render(file){
    if(typeof showdown !== 'undefined'){
        let converter = new showdown.Converter();
        converter.setFlavor('github');
        let html = converter.makeHtml(file);
        document.getElementById('globalReadMe').innerHTML = html;
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightBlock(block);
        });
    }else{
        setTimeout(function(){
            render();
        }, 100);
    }
}
</script>
</body>